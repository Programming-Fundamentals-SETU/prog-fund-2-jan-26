# 4. Shop V4.0 - Updating

Now we will add the code to update a product, using menu option 3.

![](./img/01.png) 


## Refactoring the displayed menu

We refactored the display in the previous step; your menu should be like this now:


~~~
    private int mainMenu(){
        int option = ScannerInput.readNextInt("""
               Shop Menu
               ---------
                  1) Add a product
                  2) List the Products
                  3) Update a Product
                  4) Delete a Product
                  ----------------------------
                  5) List the current products
                  6) Display average product unit cost
                  7) Display cheapest product
                  8) List products that are more expensive than a given price
                  ----------------------------
                  0) Exit
               ==>>  """);
        return option;
    }
~~~


## Store Class - getting ready for updating

In the Store class, we will add two new methods. 

First, before we update a product, we will need to locate it in the ArrayList.  Note how the method is validating the index first before accessing the ArrayList for the item.  If the product is not found, null is returned: 

~~~
    public Product findProduct(int index) {
        if (isValidIndex(index)) {
            return products.get(index);
        }
        return null;
    }
~~~

Now that we have a method for finding the product object by index number, we will use this when updating the product:

~~~
    public boolean updateProduct(int indexToUpdate, Product updateDetails) {
        //find the product object by the index number
        Product foundProduct = findProduct(indexToUpdate);

        //if the product exists, use the details passed in the updateDetails parameter to
        //update the found product in the ArrayList.
        if (foundProduct != null) {
            foundProduct.setProductName(updateDetails.getProductName());
            foundProduct.setProductCode(updateDetails.getProductCode());
            foundProduct.setUnitCost(updateDetails.getUnitCost());
            foundProduct.setInCurrentProductLine(updateDetails.isInCurrentProductLine());
            return true;
        }

        //if the product was not found, return false, indicating that the update was not successful
        return false;
    }
~~~


## Menu Item 3:  Updating a product

In the Driver class, add this method (you will notice there is some repeated code between this new method and the addProduct method - we will look at this next week):

~~~
    //ask the user to enter the index of the object to update, and
    //gather the new product data from the user and update the selected product object.
    private void updateProduct(){
        printProducts();
        int indexToUpdate = ScannerInput.readNextInt("Enter the index of the product to update ==> ");

        String productName = ScannerInput.readNextLine("Enter the Product Name:  ");
        int productCode = ScannerInput.readNextInt("Enter the Product Code:  ");
        double unitCost = ScannerInput.readNextDouble("Enter the Unit Cost:  ");

        //Ask the user to type in either a Y or an N.  This is then
        //converted to either a True or a False (i.e. a boolean value).
        char currentProduct = ScannerInput.readNextChar("Is this product in your current line (y/n): ");
        boolean inCurrentProductLine = false;
        if ((currentProduct == 'y') || (currentProduct == 'Y'))
            inCurrentProductLine = true;

        //pass the index of the product and the new product details to Store
        store.updateProduct(indexToUpdate, new Product(productName, productCode, unitCost, inCurrentProductLine));
    }

~~~

Lastly, make sure the updateProduct is called from your switch statement:

~~~
       switch (option){
                case 1 -> addProduct();
                case 2 -> printProducts();
                case 3 -> updateProduct();
                case 4 -> deleteProduct();
                case 5 -> printCurrentProducts();
                case 6 -> printAverageProductPrice();
                case 7 -> printCheapestProduct();
                case 8 -> printProductsAboveAPrice();
                default -> System.out.println("Invalid option entered: " + option);
            }
~~~


## Testing the changes

Run the project and test the following scenarios:

- Add a product using option 1.  Test option 3 - try to update the product you just added.  It should have worked as expected.

- Now try to update a product that doesn't exist e.g. enter an index of 6.  Did it still ask you to enter the details?  This is clearly a bug!

- Now delete all the products and try to do an update.  Does it correctly print out "No products in the store", BUT then it incorrectly starts asking you for the index of the product to update.  This again is a bug.  

Our updateProduct method in Driver hasn't got sufficient error checking and validation in it.  We need to rectify this!


## Menu Item 3:  Adding error checking / validation

Now refactor the updateProduct method in the Driver class with similar error checking that we used in the delete method:

~~~
    //ask the user to enter the index of the object to update, and assuming it's valid,
    //gather the new product data from the user and update the selected product object.
    private void updateProduct(){
        printProducts();
        if (store.numberOfProducts() > 0){
            //only ask the user to choose the product to update if products exist
            int indexToUpdate = ScannerInput.readNextInt("Enter the index of the product to update ==> ");
            if (store.isValidIndex(indexToUpdate)){
                String productName = ScannerInput.readNextLine("Enter the Product Name:  ");
                int productCode = ScannerInput.readNextInt("Enter the Product Code:  ");
                double unitCost = ScannerInput.readNextDouble("Enter the Unit Cost:  ");

                //Ask the user to type in either a Y or an N.  This is then
                //converted to either a True or a False (i.e. a boolean value).
                char currentProduct = ScannerInput.readNextChar("Is this product in your current line (y/n): ");
                boolean inCurrentProductLine = false;
                if ((currentProduct == 'y') || (currentProduct == 'Y'))
                    inCurrentProductLine = true;

                //pass the index of the product and the new product details to Store for updating and check for success.
                if (store.updateProduct(indexToUpdate, new Product(productName, productCode, unitCost, inCurrentProductLine))){
                    System.out.println("Update Successful");
                }
                else{
                    System.out.println("Update NOT Successful");
                }
            }
            else{
                System.out.println("There are no products for this index number");
            }
        }
    }
~~~

Run the project and test these three scenarios again:

- No products exist...try updating a product.  The message "No products in the store" should be displayed.

- Create two products...try updating a product at index 2.  The message  "There are no products for this index number" should be displayed.

- With the two products created...try updating a product at index 1.  The product should be updated and you should get a message "Update Successful".

Before moving on, make sure you can trace the origin of these messages in the code and that you understand why they are being displayed. You can use the debugger for this too - put a breakpoint on the updateProduct method.  


When done, save and close this project.  