# 6. ScannerInput

You have probably noticed that we have been adding extra lines of code to handle the Bug in `Scanner`.  The bug is this:

- when you read a String using nextLine() after reading an int, double or float, the buffers are not flushed properly.  This means that a String read taking place after an int, double or float read is ingnored.  

We have been handling this bug in `Driver` by adding extra`nextLine()` reads so that the buffers are flushed properly e.g.

- in the `runMenu` method:
~~~
            //pause the program so that the user can read what we just printed to the terminal window
            System.out.println("\nPress enter key to continue...");
            input.nextLine();
            input.nextLine(); //second read is required - bug in Scanner class; a String read is ignored straight after reading an int.
~~~

- in the `addProduct` method:

~~~
    private void addProduct(){
        input.nextLine();  //dummy read of String to clear the buffer - bug in Scanner class.

        System.out.print("Enter the Product Name:  ");
        String productName = input.nextLine();
~~~

Clearly we can't keep adding these dummy reads, particularly as we have now given the user the ability to choose which methods they want called (using the menu).  We need a better solution!


## ScannerInput class - an explanation

We will write our own class, called ScannerInput instead (code below). You don't need to understand this code yet; we will cover it in more detail as the weeks progress.  For the moment, you just need to understand what each method does and how to use them. 

The ScannerInput class has four methods:

- `readNextInt` - this method takes in a String prompt and prints it to the console (e.g. of a prompt would be "Please enter the product code").  The user input is then read and it is checked to see if what the user entered is ACTUALLY an int.  If it is an int, the value is returned.  If it isn't an int, then the prompt is printed again to the user and the validation of the input continues until the user enters a valid int.  

- `readNextDouble` - this method behaves the same as the int one above, except that it is validating for a double value. 

- `readNextLine` - this method takes in a String prompt and prints it to the console.  The full user input is then read using the Scanner `nextLine` method.  The value is returned with no validation.

- `readNextChar`- this method takes in a String prompt and prints it to the console.  The first char the user entered is then read using the Scanner **next().charAt(0)** method.  The char is returned with no validation.

If you look over the code, you will see that each of the methods defines their own local `Scanner` object, called `input`. This local object will be destroyed after each method call, so there are no buffers left unflushed.  This is how we are bypassing the Scanner bug identified above.


## ScannerInput class - the code

Create a new class called `ScannerInput` in your `src` folder.  

Within this class, cut and paste the following code into it:

~~~
import java.util.Scanner;

/**
 * This class provides methods for the robust handling of I/O using Scanner.
 * It creates a new Scanner object for each read from the user, thereby
 * eliminating the Scanner bug (where the buffers don't flush correctly after an int read).
 *
 * The methods also parse the numeric data entered to ensure it is correct. If it isn't correct,
 * the user is prompted to enter it again.
 *
 * @author Siobhan Drohan, Mairead Meagher
 * @version 1.0
 *
 */

public class ScannerInput {

    /**
     * Read an int from the user.  If the entered data isn't actually an int,
     * the user is prompted again to enter the int.
     *
     * @param prompt  The information printed to the console for the user to read
     * @return The number read from the user and verified as an int.
     */
    public static int readNextInt(String prompt) {
        do {
            var scanner = new Scanner(System.in);
            try {
                System.out.print(prompt);
                return Integer.parseInt(scanner.next());
            }
            catch (NumberFormatException e) {
                System.err.println("\tEnter a number please.");
            }
        }  while (true);
    }

    /**
     * Read a double from the user.  If the entered data isn't actually a double,
     * the user is prompted again to enter the double.
     *
     * @param prompt  The information printed to the console for the user to read
     * @return The number read from the user and verified as a double.
     */
    public static double readNextDouble(String prompt) {
        do {
            var scanner = new Scanner(System.in);
            try{
                System.out.print(prompt);
                return Double.parseDouble(scanner.next());
            }
            catch (NumberFormatException e) {
                System.err.println("\tEnter a number please.");
            }
        }  while (true);
    }

    /**
     * Read a line of text from the user.  There is no validation done on the entered data.
     *
     * @param prompt  The information printed to the console for the user to read
     * @return The String read from the user.
     */
    public static String readNextLine(String prompt) {
        Scanner input = new Scanner(System.in);
        System.out.print(prompt);
        return input.nextLine();
    }

    /**
     * Read a single character of text from the user.  There is no validation done on the entered data.
     *
     * @param prompt  The information printed to the console for the user to read
     * @return The char read from the user.
     */
    public static char readNextChar(String prompt) {
        Scanner input = new Scanner(System.in);
        System.out.print(prompt);
        return input.next().charAt(0);
    }

}
~~~


## ScannerInput class - using it in Driver

Now that we have the ScannerInput class in our project, we can start using it.  

The first thing you can do is delete the following line of code from Driver:

~~~
    private Scanner input = new Scanner(System.in);
~~~

You will notice that delete this code generates a LOT of errors...basically all the reads from the console are now highlighted as syntax errors.  We will replace EACH of these reads with a method call to our ScannerInput class instead. 


#### Driver - printProductsAboveAPrice()

Let's start with a straight forward fix.  

The current code in the `printProductsAboveAPrice` method is:

~~~
    private void printProductsAboveAPrice(){
        System.out.print("View the products costing more than this price:  ");
        double price = input.nextDouble();
        System.out.println(store.listProductsAboveAPrice(price));
    }
~~~

We will now replace the first two lines of code in the method with one line.  Our method will now look like this:

~~~
    private void printProductsAboveAPrice(){
        double price = ScannerInput.readNextDouble("View the products costing more than this price:  ");
        System.out.println(store.listProductsAboveAPrice(price));
    }
~~~

Based on the ScannerInput method descriptions above, see can you figure out what changes were made and why. 

#### Driver - addProduct()

Try refactor this method so that we are using the ScannerInput methods for all the reads from the user. 

The refactored code is here should you need it:

~~~
    private void addProduct(){

        String productName = ScannerInput.readNextLine("Enter the Product Name:  ");
        int productCode = ScannerInput.readNextInt("Enter the Product Code:  ");
        double unitCost = ScannerInput.readNextDouble("Enter the Unit Cost:  ");

        //Ask the user to type in either a Y or an N.  This is then
        //converted to either a True or a False (i.e. a boolean value).
        char currentProduct = ScannerInput.readNextChar("Is this product in your current line (y/n): ");
        boolean inCurrentProductLine = false;
        if ((currentProduct == 'y') || (currentProduct == 'Y'))
            inCurrentProductLine = true;

        boolean isAdded = store.add(new Product(productName, productCode, unitCost, inCurrentProductLine));
        if (isAdded){
            System.out.println("Product Added Successfully");
        }
        else{
            System.out.println("No Product Added");
        }
    }
~~~


#### Driver - runMenu()

Try refactor this method so that we are using a ScannerInput method for the "Press enter key to continue..." processing.   

The refactored code is here should you need it:

~~~
    private void runMenu(){
        int option = mainMenu();

        while (option != 0){

            switch (option){
                case 1 -> addProduct();
                case 2 -> printProducts();
                case 3 -> printCurrentProducts();
                case 4 -> printAverageProductPrice();
                case 5 -> printCheapestProduct();
                case 6 -> printProductsAboveAPrice();
                default -> System.out.println("Invalid option entered: " + option);
            }

            //pause the program so that the user can read what we just printed to the terminal window
            ScannerInput.readNextLine("\nPress enter key to continue...");

            //display the main menu again
            option = mainMenu();
        }

        //the user chose option 0, so exit the program
        System.out.println("Exiting...bye");
        System.exit(0);
    }
~~~


#### Driver - mainMenu()

Try refactor this method so that we are using a ScannerInput method for reading their menu choice.   

The refactored code is here should you need it:

~~~
    private int mainMenu(){
        int option = ScannerInput.readNextInt("""
               Shop Menu
               ---------
                  1) Add a product
                  2) List the Products
                  ----------------------------
                  3) List the current products
                  4) Display average product unit cost
                  5) Display cheapest product
                  6) List products that are more expensive than a given price
                  ----------------------------
                  0) Exit
               ==>>  """);
        return option;
    }
~~~

If you need to refer to the solution of ShopV3.0 at any stage, you will find it in the solutions tab.

