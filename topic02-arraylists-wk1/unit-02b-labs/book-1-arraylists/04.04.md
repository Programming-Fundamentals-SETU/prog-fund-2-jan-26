# 5. Enhancing the Menu

At this stage, you should have refactored ShopV3.0 so that it uses an ArrayList instead of a primitive array.

You will notice in our code that we are still asking the user how many products they want to add:

![](./img/02.png)

This is very restrictive for a user; they cannot add more products later on.  We need to change our menu so that we can give the user control over adding items to our app.


## Refactoring the menu

As the **Driver** class controls all the I/O, our changes will be made in this class; Store and Product will not change.

We want the following new menu displayed: 

![](./img/03.png)

First, refactor your `mainMenu` method so that it includes the following options (note the number change for some menu items):

~~~java
    private int mainMenu(){
         System.out.print("""
               Shop Menu
               ---------
                  1) Add a product
                  2) List the Products
                  ----------------------------
                  3) List the current products
                  4) Display average product unit cost
                  5) Display cheapest product
                  6) List products that are more expensive than a given price
                  ----------------------------
                  0) Exit
               ==>>  """);
        int option = input.nextInt();
        return option;
    }
~~~

Then refactor the `runMenu` method to be:

~~~
    private void runMenu(){
        int option = mainMenu();

        while (option != 0){

            switch (option){
                case 1 -> addProduct();
                case 2 -> printProducts();
                case 3 -> printCurrentProducts();
                case 4 -> printAverageProductPrice();
                case 5 -> printCheapestProduct();
                case 6 -> printProductsAboveAPrice();
                default -> System.out.println("Invalid option entered: " + option);
            }

            //pause the program so that the user can read what we just printed to the terminal window
            System.out.println("\nPress enter key to continue...");
            input.nextLine();
            input.nextLine(); //second read is required - bug in Scanner class; a String read is ignored straight after reading an int.

            //display the main menu again
            option = mainMenu();
        }

        //the user chose option 0, so exit the program
        System.out.println("Exiting...bye");
        System.exit(0);
    }  
~~~

The menu is going to control the adding of the products from **case 1** in the switch statement.  Therefore, we no longer need the `processOrder` method.  You can delete this method and the call made to the method. 

The final change that we need to make is to the `store` field...when we deleted the processOrder method, we deleted the **instantiation** of this field.  If we don't have an object instantiated, we will crash our program with a NullPointerException when we try to use it.  So, in the Driver constructor, instantiate the store object:

~~~java
    public Driver() {
        store = new Store();
        runMenu();
    }
~~~


## Run the App

Run the app; does all work as expected?  Does each menu option do what it is supposed to do? 

Test the menu with some of your own products and see if you can identify any bugs.  If you come across any, try fix them.

Before moving onto the next step, it is a good idea to familiarise yourself with the code in both the Store and the Driver class.  

Note that we made no changes to the Product class because there were no changes to how we store a single product object.  We were changing:

- how we stored the products internally in a collection.  We changed from a primitive array to an ArrayList and all that code was in `Store`.

- the menu to handle any changes to `Store` method signatures, whilst also adding a new menu option.  All of these changes, including the I/O with the user, were isolated to the `Driver` class.

